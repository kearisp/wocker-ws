#!/bin/bash

# Перевірка, чи введено домен
if [ -z "$1" ]; then
    echo "Використання: $0 <файл>"
    exit 1
fi

# Змінні
NAME=$1
CERT_DIR=/etc/nginx/certs
DAYS_VALID=365
COUNTRY="US"
STATE="State"
CITY="City"
ORGANIZATION="Organization"
ORG_UNIT="Department"
COMMON_NAME=$NAME

# Створення директорії
mkdir -p $CERT_DIR

openssl req \
    -new \
    -nodes \
    -newkey rsa:2048 \
    -keyout $CERT_DIR/$NAME.key \
    -out $CERT_DIR/$NAME.csr \
    -subj "/C=$COUNTRY/ST=$STATE/L=$CITY/O=$ORGANIZATION/OU=$ORG_UNIT/CN=$COMMON_NAME"

openssl x509 \
    -req \
    -sha256 \
    -days 1024 \
    -in $CERT_DIR/$NAME.csr \
    -CA $CERT_DIR/RootCA.pem \
    -CAkey $CERT_DIR/RootCA.key \
    -CAcreateserial \
    -extfile $CERT_DIR/$NAME.ext \
    -out $CERT_DIR/$NAME.crt
